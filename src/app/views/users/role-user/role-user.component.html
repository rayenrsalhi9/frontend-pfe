<div class="card mb-0">
  <div class="card-body">
    <div class="row">
      <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12">
        <div class="row mb-3">
          <div class="col-md-12">
            <label class="form-label" for="userSearchInput">{{
              "USERROLE.SEARCH_USER" | translate
            }}</label>
            <input
              id="userSearchInput"
              type="text"
              class="form-control"
              placeholder="{{ 'USERROLE.SEARCH_USER' | translate }}..."
              [(ngModel)]="searchText"
              (input)="filterUsers()"
            />
          </div>
        </div>

        <div class="row">
          <div class="col-md-12">
            <h6 class="text-primary mb-3">
              {{ "USERROLE.ALL_USERS" | translate }} ({{
                filteredUsers?.length || 0
              }})
            </h6>

            <div class="users-list" *ngIf="!isLoading">
              <div
                *ngFor="let user of filteredUsers"
                class="user-card"
                (click)="openRoleModal(user)"
                tabindex="0"
                (keyup.enter)="openRoleModal(user)"
              >
                <div class="user-avatar">
                  {{ user.firstName?.charAt(0) }}{{ user.lastName?.charAt(0) }}
                </div>
                <div class="user-info">
                  <div class="user-name">
                    {{ user.firstName }} {{ user.lastName }}
                  </div>
                  <div class="user-username">@{{ user.userName }}</div>
                  <div class="user-email">
                    {{ user.email }}
                  </div>
                </div>
                <div class="user-action">
                  <span class="badge">{{
                    "USERROLE.MANAGE_ROLES" | translate
                  }}</span>
                </div>
              </div>

              <div *ngIf="filteredUsers?.length === 0" class="empty-state">
                <p>{{ "USERROLE.NO_USERS_FOUND" | translate }}</p>
              </div>
            </div>

            <div *ngIf="isLoading" class="empty-state">
              <p>Loading...</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div
  *ngIf="isModalOpen"
  class="modal-overlay"
  (click)="onBackdropClick($event)"
>
  <div
    class="modal-content discord-modal"
    role="dialog"
    aria-modal="true"
    aria-labelledby="modal-title"
  >
    <div class="modal-header discord-modal-header">
      <h5 class="modal-title" id="modal-title">
        {{ "USERROLE.MANAGE_ROLES_FOR" | translate }}
        {{ selectedUser?.firstName }} {{ selectedUser?.lastName }}
      </h5>
      <button
        type="button"
        class="btn-close"
        aria-label="Close"
        (click)="closeModal()"
      >
        Ã—
      </button>
    </div>

    <div class="modal-body discord-modal-body">
      <div class="user-info-section">
        <div class="user-info-avatar">
          {{ selectedUser?.firstName?.charAt(0)
          }}{{ selectedUser?.lastName?.charAt(0) }}
        </div>
        <div class="user-info-details">
          <div class="user-info-name">
            {{ selectedUser?.firstName }} {{ selectedUser?.lastName }}
          </div>
          <div class="user-info-username">@{{ selectedUser?.userName }}</div>
        </div>
      </div>

      <div class="roles-section">
        <h6 class="roles-title">
          {{ "USERROLE.SELECT_ROLES" | translate }}
        </h6>
        <p class="roles-subtitle">
          {{ "USERROLE.SELECT_ROLES_HELP" | translate }}
        </p>

        <div class="roles-list" *ngIf="roles && roles.length > 0">
          <div
            *ngFor="let role of roles"
            class="role-item"
            [class.role-selected]="hasRole(role.id)"
          >
            <label class="role-checkbox">
              <input
                type="checkbox"
                [checked]="hasRole(role.id)"
                (change)="toggleRole(role)"
                [disabled]="isSaving"
              />
              <span class="role-name">{{ role.name }}</span>
            </label>
            <span class="role-description" *ngIf="role.description">
              {{ role.description }}
            </span>
          </div>
        </div>

        <div *ngIf="!roles || roles.length === 0" class="no-roles">
          <p>{{ "USERROLE.NO_ROLES_AVAILABLE" | translate }}</p>
        </div>
      </div>

      <div class="selected-roles-info" *ngIf="roles && roles.length > 0">
        <span class="role-count">
          {{ selectedUserRoleIds?.length || 0 }} {{ "USERROLE.OF" | translate }}
          {{ roles.length }} {{ "USERROLE.ROLES_ASSIGNED" | translate }}
        </span>
      </div>
    </div>

    <div class="modal-footer discord-modal-footer">
      <button
        type="button"
        class="btn btn-secondary"
        (click)="closeModal()"
        [disabled]="isSaving"
      >
        {{ "USERROLE.CANCEL" | translate }}
      </button>
      <button
        type="button"
        class="btn btn-primary"
        (click)="saveUserRoles()"
        [disabled]="isSaving"
      >
        {{ "USERROLE.SAVE_CHANGES" | translate }}
      </button>
    </div>
  </div>
</div>
